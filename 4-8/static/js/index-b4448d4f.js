var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,i=(e,i)=>{for(var r in i||(i={}))l.call(i,r)&&o(e,r,i[r]);if(a)for(var r of a(i))t.call(i,r)&&o(e,r,i[r]);return e};import{_ as r,W as s,X as u,Y as d}from"./index-d3c82361.js";import{T as n}from"./@element-plus-b1a64a18.js";import{E as p}from"./element-plus-520742f9.js";import{f as c,a0 as v,j as m,$ as f,a8 as b,o as g,c as y,V as h,O as j,F as _,u as w,P as x,M as C,a as z,T as k,b6 as V,b5 as S}from"./@vue-476d9f53.js";import"./vue-router-3b718848.js";import"./dayjs-43ef48e6.js";import"./@kangc-16b25a8c.js";import"./vue-3198b1a1.js";import"./axios-f45f83e3.js";import"./echarts-ed669956.js";import"./zrender-93d325f0.js";import"./vuex-9b0668b4.js";import"./js-base64-8ead6284.js";import"./vuex-persistedstate-1d34ce44.js";import"./screenfull-c3c7916b.js";import"./nprogress-fdca1b68.js";import"./lodash-es-b6050654.js";import"./@vueuse-53812618.js";import"./@ctrl-eb0b847c.js";import"./async-validator-1193b133.js";import"./memoize-one-99e54574.js";import"./escape-html-4bbaf1e1.js";import"./normalize-wheel-es-eea50788.js";import"./@floating-ui-a9dc73ab.js";const O=e=>(V("data-v-c5cc154c"),e=e(),S(),e),U=k("查询"),E=k("重置"),N=k("新增"),P=["src"],I=["onClick","icon"],q=O((()=>z("span",{class:"operation"},"删除",-1))),F={class:"pagination"},M=["src"],$=k("保存"),A=k("关闭");var D=r({setup(e){const a=localStorage.getItem("token"),l={total:"",leaderName:"",leaderMobile:"",type:""},t=c(!0),o=c(!1),r=c(i({},l)),k=c({pageNo:1,pageSize:20}),V=c(0);let S=c([]);const O=c({id:0,total:"",video:""}),D=c(),L=v({total:[{required:!0,message:"视频标题不能为空",trigger:"blur"}],video:[{required:!0,message:"请选择上传视频",trigger:"blur"}]}),T=c(!1),B=async()=>{o.value=!0;const e=await s(i(i({},r.value),k.value));o.value=!1,S.value=e.data.list,V.value=e.data.total},R=e=>{k.value.pageSize=e,B()},W=e=>{k.value.pageNo=e,B()},X=(e,a,l)=>{O.value.video=e,p({showClose:!1,message:"上传成功",type:"success"})},Y=(e,a,l)=>{p({showClose:!1,message:"上传失败",type:"danger"})},G=e=>{const a="video/mp4"===e.type||"video/ogg"===e.type,l=e.size/1024/1024<500;return a||this.$message.error("请上传视频文件!"),l||this.$message.error("上传视频大小不能超过 500MB!"),a&&l},H=e=>{T.value=!0,e?(t.value=!1,O.value.id=e.row.id,O.value.total=e.row.total,O.value.video=e.row.video):t.value=!0},J=()=>{T.value=!1,Q()},K=async()=>{D.value.validate((async e=>{if(!e)return!1;if(t.value){0==(await d({total:O.value.total,video:O.value.video})).code&&(J(),B())}else{0==(await u({id:O.value.id,total:O.value.total,video:O.value.video})).code&&(J(),B())}}))},Q=()=>{O.value={id:0,total:"",video:""}};return m((()=>{B()})),(e,s)=>{const d=f("el-input"),p=f("el-form-item"),c=f("el-col"),v=f("el-option"),m=f("el-select"),Z=f("el-button"),ee=f("el-row"),ae=f("el-form"),le=f("el-card"),te=f("el-table-column"),oe=f("el-popconfirm"),ie=f("el-table"),re=f("el-pagination"),se=f("Plus"),ue=f("el-icon"),de=f("el-upload"),ne=f("el-dialog"),pe=b("loading");return g(),y(_,null,[h(le,null,{default:j((()=>[h(ae,{inline:!0,model:r.value,class:"demo-form-inline","lable-width":"100px"},{default:j((()=>[h(ee,null,{default:j((()=>[h(c,{lg:6,md:12,sm:12},{default:j((()=>[h(p,{label:"视频标题"},{default:j((()=>[h(d,{modelValue:r.value.total,"onUpdate:modelValue":s[0]||(s[0]=e=>r.value.total=e),placeholder:"视频标题",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),h(c,{lg:6,md:12,sm:12},{default:j((()=>[h(p,{label:"创建方式"},{default:j((()=>[h(m,{style:{width:"92%"},modelValue:r.value.type,"onUpdate:modelValue":s[1]||(s[1]=e=>r.value.type=e),placeholder:"请选择",clearable:""},{default:j((()=>[h(v,{label:"后台",value:"0"}),h(v,{label:"团长",value:"1"})])),_:1},8,["modelValue"])])),_:1})])),_:1}),h(p,null,{default:j((()=>[h(Z,{type:"primary",onClick:B},{default:j((()=>[U])),_:1}),h(Z,{onClick:s[2]||(s[2]=e=>(r.value=i({},l),void B()))},{default:j((()=>[E])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),h(le,{style:{"margin-top":"10px"}},{default:j((()=>[h(Z,{tag:"div",icon:w(n),type:"primary",onClick:s[3]||(s[3]=e=>H())},{default:j((()=>[N])),_:1},8,["icon"]),x((g(),C(ie,{data:w(S),style:{width:"100%","margin-top":"10px"},"header-cell-style":{background:"#f7f8fa",color:"#000"}},{default:j((()=>[h(te,{prop:"id",label:"ID"}),h(te,{prop:"total",label:"视频标题"}),h(te,{label:"视频"},{default:j((e=>[z("video",{controls:"controls",src:e.row.video,style:{width:"150px",height:"120px"},alt:""},null,8,P)])),_:1}),h(te,{prop:"typeStr",label:"创建方式"}),h(te,{fixed:"right",label:"操作",width:"180",align:"center"},{default:j((a=>[z("span",{class:"operation",onClick:e=>H(a),icon:e.Edit},"编辑",8,I),h(oe,{"confirm-button-text":"确定","cancel-button-text":"取消","cancel-button-type":"info","icon-color":"#626AEF",title:"确定要删除吗?",onConfirm:e=>(async(e,a)=>{0===(await u({id:e,isDeleted:a})).code&&B()})(a.row.id,1),onCancel:e.cancelEvent},{reference:j((()=>[q])),_:2},1032,["onConfirm","onCancel"])])),_:1})])),_:1},8,["data"])),[[pe,o.value]]),z("div",F,[h(re,{background:"",layout:"total, sizes, prev, pager, next, jumper","page-size":k.value.pageSize,"onUpdate:page-size":s[4]||(s[4]=e=>k.value.pageSize=e),"current-page":k.value.pageNo,"onUpdate:current-page":s[5]||(s[5]=e=>k.value.pageNo=e),"page-sizes":[10,20,50,100,200,500],total:V.value,onSizeChange:R,onCurrentChange:W},null,8,["page-size","current-page","total"])])])),_:1}),h(ne,{modelValue:T.value,"onUpdate:modelValue":s[8]||(s[8]=e=>T.value=e),title:t.value?"新增视频":"编辑视频",width:"600px",close:Q},{default:j((()=>[h(ae,{ref_key:"videoFormRef",ref:D,rules:w(L),model:O.value,class:"demo-form-inline","lable-width":"100px"},{default:j((()=>[h(p,{label:"视频标题",prop:"total"},{default:j((()=>[h(d,{modelValue:O.value.total,"onUpdate:modelValue":s[6]||(s[6]=e=>O.value.total=e),placeholder:"视频标题",clearable:""},null,8,["modelValue"])])),_:1}),h(p,{label:"视频内容",prop:"video"},{default:j((()=>[h(de,{accept:"video/*","file-list":e.fileList,"onUpdate:file-list":s[7]||(s[7]=a=>e.fileList=a),class:"video-uploader","show-file-list":!1,action:w("https://qct.hnliyue.cn/youth")+"/upload/oss",headers:{Authorization:w(a)},"on-success":X,"on-error":Y,"before-upload":G},{default:j((()=>[O.value.video?(g(),y("video",{key:0,class:"avatar",controls:"controls",src:O.value.video},null,8,M)):(g(),C(ue,{key:1,class:"video-uploader-icon"},{default:j((()=>[h(se)])),_:1}))])),_:1},8,["file-list","action","headers"])])),_:1}),h(p,{class:"footer"},{default:j((()=>[h(Z,{type:"primary",onClick:K},{default:j((()=>[$])),_:1}),h(Z,{onClick:J},{default:j((()=>[A])),_:1})])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue","title"])],64)}}},[["__scopeId","data-v-c5cc154c"]]);export{D as default};
