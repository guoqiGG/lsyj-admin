var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,o=(e,o)=>{for(var u in o||(o={}))l.call(o,u)&&r(e,u,o[u]);if(a)for(var u of a(o))t.call(o,u)&&r(e,u,o[u]);return e};import{_ as u,Q as n,D as s,R as i,S as d}from"./index-d3c82361.js";import{T as p,V as m}from"./@element-plus-b1a64a18.js";import{E as c}from"./element-plus-520742f9.js";import{f as v,a0 as f,j as b,$ as g,a8 as h,o as w,c as j,V as y,O as _,F as I,u as V,P as x,M as z,a as C,a4 as k,T as N,b6 as D,b5 as Y}from"./@vue-476d9f53.js";import"./vue-router-3b718848.js";import"./dayjs-43ef48e6.js";import"./@kangc-16b25a8c.js";import"./vue-3198b1a1.js";import"./axios-f45f83e3.js";import"./echarts-ed669956.js";import"./zrender-93d325f0.js";import"./vuex-9b0668b4.js";import"./js-base64-8ead6284.js";import"./vuex-persistedstate-1d34ce44.js";import"./screenfull-c3c7916b.js";import"./nprogress-fdca1b68.js";import"./lodash-es-b6050654.js";import"./@vueuse-53812618.js";import"./@ctrl-eb0b847c.js";import"./async-validator-1193b133.js";import"./memoize-one-99e54574.js";import"./escape-html-4bbaf1e1.js";import"./normalize-wheel-es-eea50788.js";import"./@floating-ui-a9dc73ab.js";const S=e=>(D("data-v-31a91b3a"),e=e(),Y(),e),O=N("查询"),M=N("重置"),U=N("新增"),E=N("导出"),P=["onClick"],q=S((()=>C("span",{class:"operation"},"删除",-1))),A={class:"pagination"},F=N("保存"),H=N("关闭");var J=u({setup(e){const a=v(!1),l={name:null,time:[]},t=v(o({},l)),r=v({pageNo:1,pageSize:10}),u=v(0);let N=v([]),D=v([]);const Y=async()=>{a.value=!0;let e=o({},r.value);e.name=t.value.name,t.value.time&&(e.startDate=t.value.time[0],e.endDate=t.value.time[1]);const l=await n(e);a.value=!1,u.value=l.data.total,N.value=[],l.data.list.map(((e,a)=>{let l=[];e.gifts.map(((a,t)=>{a&&(a.parentName=e.name,a.parentId=e.id,a.parentNumber=e.number,l.push(a.id),a.ruleIds=l,N.value.push(a))}))})),S(N.value)},S=e=>{let a=[],l=0;for(let[t,r]of e.entries())0==t?(a.push(1),l=0):r.parentId&&r.parentId==e[t-1].parentId?(a[l]+=1,a.push(0)):(a.push(1),l=t);D.value=a},J=({row:e,column:a,rowIndex:l,columnIndex:t})=>{if(0===t){return[D.value[l],1]}if(1===t){return[D.value[l],1]}if(7===t){return[D.value[l],1]}},R=e=>{r.value.pageSize=e,Y()},T=e=>{r.value.pageNo=e,Y()},Q=v([]),$=v(!1),B=v(!1),G=v(null),K=v({name:"",number:"",total:"",time:null}),L=f({name:[{required:!0,message:"请输入合成卡名",trigger:"blur"}],number:[{required:!0,message:"请输入限制数量",trigger:"blur"}],ruleIds:[{required:!0,message:"请选择礼品卡",trigger:"blur"}]});return b((()=>{Y(),(async()=>{const e=await s({pageNo:1,pageSize:1e3});Q.value=e.data.list})()})),(e,n)=>{const s=g("el-input"),f=g("el-form-item"),b=g("el-col"),D=g("el-date-picker"),S=g("el-button"),W=g("el-row"),X=g("el-form"),Z=g("el-card"),ee=g("el-table-column"),ae=g("el-popconfirm"),le=g("el-table"),te=g("el-pagination"),re=g("el-option"),oe=g("el-select"),ue=g("el-dialog"),ne=h("loading");return w(),j(I,null,[y(Z,null,{default:_((()=>[y(X,{inline:!0,model:t.value,class:"demo-form-inline","lable-width":"100px"},{default:_((()=>[y(W,null,{default:_((()=>[y(b,{lg:6,md:8,sm:12},{default:_((()=>[y(f,{label:"合成卡名"},{default:_((()=>[y(s,{modelValue:t.value.name,"onUpdate:modelValue":n[0]||(n[0]=e=>t.value.name=e),placeholder:"合成卡名",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),y(b,{lg:6,md:8,sm:12},{default:_((()=>[y(f,{label:"时间筛选"},{default:_((()=>[y(D,{modelValue:t.value.time,"onUpdate:modelValue":n[1]||(n[1]=e=>t.value.time=e),type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","date-format":"YYYY/MM/DD ddd","time-format":"A hh:mm:ss","value-format":"YYYY-MM-DD h:m:s"},null,8,["modelValue"])])),_:1})])),_:1}),y(f,null,{default:_((()=>[y(S,{type:"primary",onClick:Y},{default:_((()=>[O])),_:1}),y(S,{onClick:n[2]||(n[2]=e=>(t.value=o({},l),void Y()))},{default:_((()=>[M])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),y(Z,{style:{"margin-top":"10px"}},{default:_((()=>[y(S,{type:"primary",icon:V(p),class:"add",onClick:n[3]||(n[3]=e=>($.value=!0,B.value=!1,void(K.value={})))},{default:_((()=>[U])),_:1},8,["icon"]),y(S,{icon:V(m),class:"add"},{default:_((()=>[E])),_:1},8,["icon"]),x((w(),z(le,{data:V(N),"span-method":J,border:"",style:{width:"100%"},"header-cell-style":{background:"#f7f8fa",color:"#000"}},{default:_((()=>[y(ee,{align:"center",prop:"parentName",label:"合成卡名称","show-overflow-tooltip":""}),y(ee,{align:"center",prop:"parentNumber",label:"需礼品卡数","show-overflow-tooltip":""}),y(ee,{align:"center",prop:"name",label:"礼品卡名称","show-overflow-tooltip":""}),y(ee,{align:"center",prop:"number",label:"用户最大领取数量","show-overflow-tooltip":""}),y(ee,{align:"center",prop:"total",label:"礼品卡总数量","show-overflow-tooltip":""}),y(ee,{align:"center",prop:"startDate",label:"开始时间","show-overflow-tooltip":""}),y(ee,{align:"center",prop:"endDate",label:"开始时间","show-overflow-tooltip":""}),y(ee,{fixed:"right",label:"操作",width:"180",align:"center"},{default:_((a=>[C("span",{class:"operation",onClick:e=>{return l=a.row,B.value=!0,K.value.name=l.parentName,K.value.number=l.parentNumber,K.value.ruleIds=l.ruleIds,K.value.id=l.parentId,void($.value=!0);var l}},"修改",8,P),y(ae,{"confirm-button-text":"确定","cancel-button-text":"取消","cancel-button-type":"info","icon-color":"#626AEF",title:"确定要删除吗?",onConfirm:e=>(async e=>{const a=await i({id:e.parentId,isDeleted:1});if(0!==a.code)return c.error(a.msg),!1;c.success("删除成功"),Y()})(a.row),onCancel:e.cancelEvent},{reference:_((()=>[q])),_:2},1032,["onConfirm","onCancel"])])),_:1})])),_:1},8,["data"])),[[ne,a.value]]),C("div",A,[y(te,{background:"",layout:"total, sizes, prev, pager, next, jumper","page-size":r.value.pageSize,"onUpdate:page-size":n[4]||(n[4]=e=>r.value.pageSize=e),"current-page":r.value.pageNo,"onUpdate:current-page":n[5]||(n[5]=e=>r.value.pageNo=e),"page-sizes":[10,20,50,100,200,500],total:u.value,onSizeChange:R,onCurrentChange:T},null,8,["page-size","current-page","total"])])])),_:1}),y(ue,{modelValue:$.value,"onUpdate:modelValue":n[11]||(n[11]=e=>$.value=e),title:B.value?"编辑合成卡":"新增合成卡",width:"600px"},{default:_((()=>[y(X,{ref_key:"formRef",ref:G,model:K.value,rules:V(L),class:"add_dialog","lable-width":"100px"},{default:_((()=>[y(f,{label:"合成卡名",prop:"name"},{default:_((()=>[y(s,{modelValue:K.value.name,"onUpdate:modelValue":n[6]||(n[6]=e=>K.value.name=e),placeholder:"合成卡名",clearable:""},null,8,["modelValue"])])),_:1}),y(f,{label:"礼品卡名",prop:"ruleIds"},{default:_((()=>[y(oe,{modelValue:K.value.ruleIds,"onUpdate:modelValue":n[7]||(n[7]=e=>K.value.ruleIds=e),multiple:"",placeholder:"请选择礼品卡",style:{width:"240px"}},{default:_((()=>[(w(!0),j(I,null,k(Q.value,(e=>(w(),z(re,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),y(f,{label:"需礼品卡数",prop:"number"},{default:_((()=>[y(s,{type:"number",modelValue:K.value.number,"onUpdate:modelValue":n[8]||(n[8]=e=>K.value.number=e),modelModifiers:{number:!0},placeholder:"需礼品卡数",clearable:""},null,8,["modelValue"])])),_:1}),y(f,{class:"footer"},{default:_((()=>[y(S,{type:"primary",onClick:n[9]||(n[9]=e=>(G.value,void G.value.validate((async e=>{if(!e)return c.error("表单验证失败"),!1;{const e=v();let a={name:K.value.name,number:K.value.number,ruleIds:"",id:K.value.id};K.value.ruleIds.map(((e,l)=>{l<K.value.ruleIds.length?a.ruleIds+=e+",":a.ruleIds+=e})),K.value.id?e.value=await i(JSON.stringify(a)):e.value=await d(JSON.stringify(a)),0==e.value.code&&($.value=!1,c.success("提交成功"),Y())}}))))},{default:_((()=>[F])),_:1}),y(S,{onClick:n[10]||(n[10]=e=>$.value=!1)},{default:_((()=>[H])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])],64)}}},[["__scopeId","data-v-31a91b3a"]]);export{J as default};
